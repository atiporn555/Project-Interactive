<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>5 คืนสยอง - คืนที่ 2</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="Night4-3am-for-start1-2.css">
  <style>
    .volume-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(0,0,0,0.3);
      padding: 6px 10px;
      border-radius: 8px;
      z-index: 1000;
    }

    .volume-controls input[type="range"] {
      width: 120px;
      accent-color: red;
    }

    .volume-button {
      background-color: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      padding: 6px 10px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body onclick="nextText()">
  <audio id="bg-sound" src="sounds/dark-horror-soundscape-345814.mp3" loop></audio>

  <div class="volume-controls" onclick="event.stopPropagation()">
    <button class="volume-button" id="vol-down">🔉</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
    <button class="volume-button" id="vol-up">🔊</button>
  </div>

  <div class="scene-container">
    <div id="night-label">03:00 a.m</div>
    <div class="text-box" id="text-box"></div>
  </div>

  <script>
    const textBox = document.getElementById("text-box");
    const nightLabel = document.getElementById("night-label");
    const bgSound = document.getElementById("bg-sound");

    const texts = [
      "น้ำฝน: เฮ้ออ... วันนี้พอแค่นี้ดีกว่า เหนื่อยจนอยากกลับไปพักเต็มที",
      "(ฉันปิดร้านให้เรียบร้อย แล้วรีบออกมาโดยไม่รอช้า)",
      "ซอยที่ฉันใช้กลับบ้านประจำกำลังซ่อมแซมอยู่ ทำให้ต้องอ้อมไปทางลัดที่ไม่ค่อยอยากใช้เท่าไหร่",
      "ทางนั้นทั้งเปลี่ยว ทั้งมืด แถมมักจะมีคนเมาเดินผ่านไปมาเป็นประจำ",
      "ระหว่างเดิน...",
      "น้ำฝน: แปลกดีนะ... ฉันแทบไม่เคยผ่านทางนี้เลย มันดูอึมครึมยังไงไม่รู้",
      "น้ำฝน: กลิ่นบุหรี่ก็ลอยฟุ้งไปทั่วอีกต่างหาก...",
      "รอบตัวฉันมืดสนิท มีเพียงแสงไฟสลัวจากเสาไฟบางต้นที่ยังใช้งานได้",
      "น้ำฝน: หือ...? รู้สึกเหมือนมีใครเดินตามมา...",
      "(ฉันหันกลับไปมองอย่างระแวง...)",
      "น้ำฝน: ...?",
      "ชายแปลกหน้าสวมเสื้อยืดสีขาวกำลังเดินตามมาอยู่ห่าง ๆ",
      "น้ำฝน: (เขาเป็นคนแถวนี้เหรอ...? หรือว่าเพิ่งเลิกงานเหมือนฉัน?)",
      "(ฉันพยายามไม่คิดมาก แล้วรีบเร่งฝีเท้าต่อไป)"
    ];

    // Mapping ข้อความ → background
    const backgroundMap = {
      "ซอยที่ฉันใช้กลับบ้านประจำกำลังซ่อมแซมอยู่ ทำให้ต้องอ้อมไปทางลัดที่ไม่ค่อยอยากใช้เท่าไหร่": "images/road-dark.png",
      "(ฉันหันกลับไปมองอย่างระแวง...)": "images/stalker.png"
    };

    let index = 0;
    let isTransitioning = false;
    let hasShownNightTitle = false;

    function nextText() {
      if (isTransitioning) return;
      isTransitioning = true;

      if (!hasShownNightTitle) {
        nightLabel.style.opacity = 1;
        setTimeout(() => {
          nightLabel.style.opacity = 0;
          hasShownNightTitle = true;
          isTransitioning = false;
        }, 1500);
        return;
      }

      if (index < texts.length) {
        textBox.style.opacity = 0;
        setTimeout(() => {
          const currentText = texts[index++];
          textBox.textContent = currentText;
          textBox.style.opacity = 1;

          // เปลี่ยน background ถ้าข้อความตรงกับ mapping
          if (backgroundMap[currentText]) {
            document.body.style.backgroundImage = `url('${backgroundMap[currentText]}')`;
          }

          isTransitioning = false;
        }, 400);
      } else {
        window.location.href = "Night4-3am-lockscreen.html";
      }
    }

    window.onload = () => {
      nightLabel.style.opacity = 1;

      // เริ่มเล่นซาวด์ background
      bgSound.volume = 0.5;
      window.addEventListener('click', () => {
        if (bgSound.paused) bgSound.play().catch(() => console.log('คลิกเพื่อเล่นเพลง'));
      }, { once: true });

      // ปุ่ม volume
      const volumeSlider = document.getElementById('volumeSlider');
      const volDown = document.getElementById('vol-down');
      const volUp = document.getElementById('vol-up');

      volumeSlider.addEventListener('input', () => {
        bgSound.volume = parseFloat(volumeSlider.value);
      });

      volDown.addEventListener('click', (e) => {
        e.stopPropagation();
        bgSound.volume = Math.max(0, bgSound.volume - 0.05);
        volumeSlider.value = bgSound.volume.toFixed(2);
      });

      volUp.addEventListener('click', (e) => {
        e.stopPropagation();
        bgSound.volume = Math.min(1, bgSound.volume + 0.05);
        volumeSlider.value = bgSound.volume.toFixed(2);
      });
    };
  </script>
</body>
</html>
