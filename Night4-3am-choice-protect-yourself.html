<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>5 คืนสยอง - คืนที่ 4</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="Night4-3am-choice-protect-yourself.css">
  <style>
    body {
      background: url("images/scary.png") no-repeat center center fixed;
      background-size: cover;
      transition: background-image 1s ease-in-out;
    }

    /* หลอดเวลา */
    #timer-bar-container {
      width: 100%;
      max-width: 500px;
      height: 20px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      margin: 20px auto 0;
      overflow: hidden;
      box-shadow: 0 0 10px black;
    }

    #timer-bar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #ff0000, #ffcc00);
      transition: width 0.1s linear;
    }
  </style>
</head>
<body onclick="nextText()">
  <div class="scene-container">
    <div class="text-box" id="text-box"></div>
    <div class="choice-box" id="choice-box" style="display: none;">
      <button class="choice-button" onclick="choose(1)">กุญแจห้องใช้แทงไปที่คอ</button>
      <button class="choice-button" onclick="choose(2)">น้ำหอมที่มีแอลกอฮอลผสม</button>
      <button class="choice-button" onclick="choose(3)">ใช้ปากกัดมือของไทม์</button>
      
      <!-- หลอดเวลา -->
      <div id="timer-bar-container">
        <div id="timer-bar"></div>
      </div>
    </div>
  </div>

  <script>
    const textBox = document.getElementById("text-box");
    const choiceBox = document.getElementById("choice-box");
    const timerBar = document.getElementById("timer-bar");

    const texts = [
      '<span class="name">น้ำฝน:</span> "ไม่เป็นไรค่ะ…หนูเดินเองได้ เดี๋ยวก็ถึงแล้ว"',
      '<span class="inner-thought">(ฉันพยายามรักษาน้ำเสียงให้เป็นปกติ แม้ในใจจะเริ่มตื่นกลัว)</span>',
      '<span class="name">ไทม์:</span> "แต่พี่ไม่ให้ไปคนเดียวนะ มันอันตรายตอนดึก ๆ แบบนี้"',
      '<span class="inner-thought">(เขาก้าวมาขวางหน้า ใกล้จนได้กลิ่นบุหรี่กับกลิ่นเหงื่อผสมกัน เหมือนกับจงใจแช่ในอากาศ)</span>',
      '<span class="name">น้ำฝน:</span> "ขอโทษนะคะ หนูขอทางหน่อย"',
      '<span class="name">ไทม์:</span> "เดินผ่านป่านี้คนเดียวมันไม่ดีหรอกฝน…รู้มั้ยว่าผู้หญิงหายไปแถวนี้ตั้งกี่คน"',
      '<span class="name">ไทม์:</span> "แต่ไม่ต้องห่วง…พี่อยู่ตรงนี้แล้วนี่ไง…พี่จะดูแลเอง"',
      '<span class="inner-thought">(มือเขาเอื้อมมาจับไหล่ฉัน แล้วค่อย ๆ ลูบลงมาช้า ๆ)</span>',
      '<span class="name">น้ำฝน:</span> (เสียงสั่น) "พี่…อย่าทำแบบนี้เลย…หนูจะไปแล้ว"',
      '<span class="inner-thought">(ฉันเบี่ยงตัวออก แต่เขากลับคว้าแขนฉันแน่นจนเจ็บ)</span>',
      '<span class="name">ไทม์:</span> "ไม่เอาน่า…ฝนก็สวยดีออก อยู่กับพี่แป๊บเดียว…ไม่มีใครเห็นหรอก"',
      '<span class="inner-thought">(จากนั้นเขาพยายามลากฉันไปทางข้างทางที่มีแต่ต้นไม้ ไม่มีไฟ ไม่มีตึก ไม่มีคนเลย — พงหญ้าและกลิ่นดินชื้นเริ่มใกล้ขึ้นเรื่อย ๆ)</span>',
      '<span class="name">น้ำฝน:</span> "พี่อย่า!!! ปล่อยหนูไปเถอะนะ!!!"',
      '<span class="inner-thought">(ฉันร้องลั่นทั้งน้ำตา ดิ้นเต็มแรง สะบัดแขนและพยายามหาของที่สามารถใช้เป็นอาวุธได้ในกระเป๋า)</span>',
      '<strong class="danger">คุณจะใช้อะไรในการเอาตัวรอด?</strong>'
    ];

    let index = 0;
    let isTransitioning = false;
    let timerInterval;

    function nextText() {
      if (isTransitioning || choiceBox.style.display === "block") return;
      isTransitioning = true;

      textBox.style.opacity = 0;
      setTimeout(() => {
        if (index < texts.length) {
          textBox.innerHTML = texts[index++];
          textBox.style.opacity = 1;
          isTransitioning = false;
        } else {
          textBox.style.display = "none";
          choiceBox.style.display = "block";
          startTimer(10); // เริ่มจับเวลา 10 วิ
          isTransitioning = false;
        }
      }, 500);
    }

    function startTimer(seconds) {
      let timeLeft = seconds;
      let totalWidth = 100; // %
      let step = totalWidth / (seconds * 10); // ลดทุก 0.1 วิ

      let currentWidth = totalWidth;
      timerInterval = setInterval(() => {
        currentWidth -= step;
        if (currentWidth <= 0) {
          currentWidth = 0;
          clearInterval(timerInterval);
          window.location.href = "GameOver.html";
        }
        timerBar.style.width = currentWidth + "%";
      }, 100);
    }

    function choose(option) {
      clearInterval(timerInterval); 
      if (option === 1) window.location.href = "Night4-use-key-start1.html";
      else if (option === 2) window.location.href = "Night4-use-perfume-start1.html";
      else if (option === 3) window.location.href = "Night4-use-bite.html";
    }

    window.onload = function() {
      nextText();

      // เปลี่ยนภาพตามเวลา
      setTimeout(() => { document.body.style.backgroundImage = "url('images/carzy-time.png')"; }, 6000);
      setTimeout(() => { document.body.style.backgroundImage = "url('images/Time-hold-fon.png')"; }, 11000);
      setTimeout(() => { document.body.style.backgroundImage = "url('images/Time-pull-Fon2.png')"; }, 16000);
      setTimeout(() => { document.body.style.backgroundImage = "url('images/Find-a-weapon.png')"; }, 26000);
    };
  </script>
</body>
</html>
